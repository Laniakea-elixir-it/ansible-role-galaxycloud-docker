---
#_____________________________________
#run delete user python script

- name: delete-user 
  command: >
   docker exec galaxydocker /bin/bash -c 
   ". $GALAXY_VIRTUAL_ENV/bin/activate &&
   python /opt/delete_galaxy_user.py
   -u admin@galaxy.org -c /etc/galaxy/galaxy.yml "

#_____________________________________
#run create user python script

- name: user creation 
  command: >
   docker exec galaxydocker /bin/bash -c ". $GALAXY_VIRTUAL_ENV/bin/activate
   && python /usr/local/bin/create_galaxy_user.py 
   --user {{ GALAXY_ADMIN_EMAIL }} --password {{ GALAXY_ADMIN_PASSWORD }}
   -c $GALAXY_CONFIG_FILE  --key {{ GALAXY_ADMIN_API_KEY }} && deactivate "

#_____________________________________
#test if there is the wf directory

- name: test workflow directory
  command: docker exec galaxydocker /bin/bash -c "test -d /home/galaxy/workflows "
  failed_when: false
  changed_when: false
  register: testdir
  ignore_errors: yes

#_____________________________________
#share workflow with admin user

- name: share wf
  command: >
    docker exec galaxydocker /bin/bash -c ". $GALAXY_VIRTUAL_ENV/bin/activate 
    && workflow-install --workflow_path $GALAXY_HOME/workflows/ 
    -g http://localhost:80 -u {{ GALAXY_ADMIN_EMAIL }} -p {{ GALAXY_ADMIN_PASSWORD }} "
  when: testdir.rc == 0

